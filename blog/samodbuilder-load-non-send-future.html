<!DOCTYPE html>
<html lang="en">
<head>
	<title>SamodBuilder Load Non-Send Future: Causes &amp; Solutions</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SamodBuilder Load Non-Send Future: Causes & Solutions...">
    <link rel="canonical" href="https://catatansoal.github.io/blog/samodbuilder-load-non-send-future">
	<meta property="og:type" content="article">
	<meta property="og:title" content="SamodBuilder Load Non-Send Future: Causes &amp; Solutions">
	<meta property="og:description" content="SamodBuilder Load Non-Send Future: Causes & Solutions...">
	<meta property="og:url" content="https://catatansoal.github.io/blog/samodbuilder-load-non-send-future">
	<meta property="og:site_name" content="Question Notes">
	<meta property="article:published_time" content="2025-08-04T08:28:47+00:00">
	<meta property="article:author" content="ADMIN">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" as="script" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js">
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <link rel="preload" fetchpriority="high" as="image" href="https://tse4.mm.bing.net/th?q=Troubleshooting%20and%20Solutions%20for%20SamodBuilder%20Load%20Returns%20Non-Send%20Future">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style type="text/css">
    	:root{--primary-color:#3740ff;--text-color:#202124;--background-color:#ffffff;--gray-100:#f8f9fa;--gray-200:#e9ecef}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;line-height:1.6;color:var(--text-color);background-color:var(--background-color)}.container{max-width:1200px;margin:0 auto;padding:0 1.5rem}.header{background-color:var(--background-color);border-bottom:1px solid var(--gray-200);position:sticky;top:0;z-index:100}.nav{padding:.5rem 0}.nav-container{display:flex;justify-content:space-between;align-items:center;gap:1rem}.nav-left{display:flex;align-items:center;flex-shrink:0}.logo{font-weight:700;color:var(--primary-color)}.blog-tag{margin-left:1rem;padding:.25rem .5rem;background-color:var(--gray-100);border-radius:4px;font-size:.875rem}.nav-search{flex-grow:1;max-width:300px}.search-form{position:relative;width:100%}.search-input{width:100%;padding:.5rem 2.5rem .5rem 1rem;border:1px solid var(--gray-200);border-radius:24px;font-size:.875rem;transition:all 0.2s}.search-input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgb(55 64 255 / .1)}.search-button{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#5f6368;cursor:pointer;padding:.25rem;display:flex;align-items:center;justify-content:center}.search-button:hover{color:var(--primary-color)}.nav-toggle{display:none;background:none;border:none;cursor:pointer;padding:.5rem}.hamburger{display:block;position:relative;width:24px;height:2px;background:var(--text-color);transition:all 0.3s}.hamburger::before,.hamburger::after{content:'';position:absolute;width:24px;height:2px;background:var(--text-color);transition:all 0.3s}.hamburger::before{top:-6px}.hamburger::after{bottom:-6px}.nav-toggle-active .hamburger{background:#fff0}.nav-toggle-active .hamburger::before{transform:rotate(45deg);top:0}.nav-toggle-active .hamburger::after{transform:rotate(-45deg);bottom:0}.nav-list{display:flex;list-style:none;gap:2rem}.nav-link{color:var(--text-color);text-decoration:none;font-size:.9rem;transition:color 0.2s}.nav-link:hover{color:var(--primary-color)}.article-header{padding:2rem 0;background-color:var(--gray-100)}.article-layout{display:grid;grid-template-columns:1fr 350px;gap:3rem;padding:1rem 0;align-items: start}h1,h2,h3,h4,h5,h6{font-family:"Crimson Text","Times New Roman",Times,serif}h1{font-size:2.5rem;line-height:1.2;margin-bottom:1rem}.meta{color:#5f6368;font-size:.875rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.view-count{display:inline-flex;align-items:center;gap:.25rem}.view-count svg{color:#5f6368}.content{min-width:0;border-bottom:1px solid #dddddd5e;margin-top:1rem;white-space:pre-line !important;overflow-wrap:break-word;overflow-x:auto;word-break:break-word}.lead{font-size:1.25rem;color:#5f6368;margin-bottom:2rem}h2,h3,h4,h5,h6{font-size:1.75rem;margin:1rem 0 1rem}p,pre,ol,ul>li{margin-bottom:1rem;font-family:"Newsreader",serif;font-optical-sizing:auto;font-style:normal;font-size:1.3rem;text-align: justify;}p>code{font-size:1rem;font-weight:700;padding:.1rem .3rem .1rem .3rem;background:#0000000f;color:#000;border-radius:5px}hr{margin:1rem 0 1rem 0}.code-example{background-color:var(--gray-100);padding:1.5rem;border-radius:8px;margin:1.5rem 0;overflow-x:auto}code{font-family:'Roboto Mono',monospace;font-size:.875rem}ul{margin:.2rem 0;padding-left:1.5rem}.related-posts{background-color:var(--gray-100);padding:1.5rem;border-radius:8px;position:sticky;top:5rem}.related-posts-title,.newpost-posts-list{font-size:1.75rem;margin:0 0 1rem}.related-posts-list{display:flex;flex-direction:column;gap:.5rem}.related-post,.newpost-post{border-bottom:1px solid #ddd;padding-bottom:10px;margin-bottom:10px}.related-post:last-child,.newpost-post:last-child{padding-bottom:0;border-bottom:none}.related-post-title,.newpost-post-title{font-size:1.2rem;margin:0 0 .1rem;font-family:"Newsreader",serif;font-optical-sizing:auto;font-style:normal;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;overflow: hidden;}.related-post-title a,.newpost-post-title a{color:var(--text-color);text-decoration:none;transition:color 0.2s}.related-post-title a:hover,.newpost-post-title a:hover{color:var(--primary-color)}.related-post time{font-size:.875rem;color:#5f6368}.footer{background-color:var(--gray-100);padding:2rem 0;margin-top:4rem;color:#5f6368;font-size:.875rem}.nav-menu>ul>li{margin-bottom:0}@media (max-width:1024px){.container{max-width:800px}.article-layout{grid-template-columns:1fr;gap:2rem}.related-posts{position:static}}@media (max-width:768px){.nav-container{flex-wrap:wrap}.nav-search{order:3;max-width:none;width:100%;margin-top:.1rem}.nav-toggle{display:block}.nav-menu{display:none;position:absolute;top:100%;left:0;right:0;background:var(--background-color);padding:1rem 0;border-bottom:1px solid var(--gray-200)}.nav-menu-active{display:block}.nav-list{flex-direction:column;gap:.1rem;padding:0 1.5rem}.nav-link{display:block;padding:.2rem 0}h1{font-size:2rem}.article-header{padding:2rem 0}.content{padding:.1rem 0}}table{width:100%;border-collapse:collapse;margin:20px 0;font-family:'Arial',sans-serif}th,td{padding:12px 15px;text-align:left;border:1px solid #ddd}th{background-color:#0F7F0B;color:#FFF}td{background-color:#f9f9f9}tr:nth-child(even) td{background-color:#f2f2f2}@media screen and (max-width:768px){table{border:0;display:block;overflow-x:auto;white-space:nowrap}th,td{padding:10px;text-align:right}th{background-color:#0F7F0B;color:#FFF}td{background-color:#f9f9f9;border-bottom:1px solid #ddd}tr:nth-child(even) td{background-color:#f2f2f2}}a{text-decoration:none;color:#540707}.katex-html{padding: .2rem;color: #000;font-weight: 700;font-size: 1.3rem;overflow-wrap: break-word;max-width: 100%;white-space: normal !important}.category{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin:1rem 0 1rem 0}.tag{font-size:1rem;font-weight:700;padding:.1rem .3rem .1rem .3rem;background:#0000000f;color:#000;border-radius:5px;font-family:"Newsreader",serif}.tag>a{text-decoration:none;color:#000}img{margin:auto;display:block;max-width:100%;height:auto;margin-bottom:1rem}.katex{white-space: pre-line !important;display: inline-block;max-width: 100%;overflow-x: auto;overflow-y: hidden;scrollbar-width: thin;overflow-wrap: break-word;word-break: break-word;vertical-align: -7px}.content > p {overflow-wrap: break-word;word-break: break-word}
    </style>
    <style type="text/css">
    	pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}
		.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}
    	pre{-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-weight:400;word-break:break-word;word-wrap:break-word;box-sizing:inherit;border-radius:4px;overflow-x:auto;font-family:source-code-pro,Menlo,Monaco,"Courier New",Courier,monospace}code{-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;word-wrap:break-word;word-break:break-word;font-style:normal;line-height:20px;letter-spacing:-.003em;box-sizing:inherit;font-weight:400;font-size:75%;font-family:source-code-pro,Menlo,Monaco,"Courier New",Courier,monospace}
    </style>
    <style type="text/css">
    	.back-to-top{position:fixed;bottom:20px;right:20px;background-color:#a73f3f;color:#fff;padding:8px 10px;border-radius:50%;box-shadow:0 4px 6px rgb(0 0 0 / .2);font-size:10px;font-weight:700;text-decoration:none;text-align:center;transition:opacity 0.3s ease,visibility 0.3s ease;z-index:99999;opacity:1;visibility:visible}.back-to-top:hover{background-color:#0056b3}
    </style>
    <style type="text/css">
        .ad-header {margin: 1rem auto 1rem;background-color: #fdfdfd;text-align: center;display: block;}.ad-header .ad-wrapper {min-height: 90px;display: flex;align-items: center;justify-content: center;font-size: 1rem;color: #555;font-weight: 500;padding: 3rem;border: 1px dashed #ccc;border-radius: 6px;}@media (max-width: 768px) {.ad-header {padding: 0.75rem;}}.ad-sidebar {margin: 0 0 1rem;background-color: #fefefe;text-align: center;padding: 0px;width: 100%;max-width: 100%;display: block;}.ad-sidebar .ad-wrapper {min-height: 250px;display: flex;align-items: center;justify-content: center;font-size: 1rem;color: #444;font-weight: 500;border: 1px dashed #aaa;border-radius: 6px;padding: 0rem;}@media (max-width: 1024px) {.ad-sidebar {padding: 0.75rem;}}
    </style>
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Article",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://catatansoal.github.io/blog/samodbuilder-load-non-send-future"
          },
          "headline": "SamodBuilder Load Non-Send Future: Causes &amp; Solutions",
          "description": "SamodBuilder Load Non-Send Future: Causes & Solutions...",
          "image": [
            "https://tse4.mm.bing.net/th?q=Troubleshooting%20and%20Solutions%20for%20SamodBuilder%20Load%20Returns%20Non-Send%20Future"
          ],
          "author": {
            "@type": "Person",
            "name": "ADMIN",
            "jobTitle": "Editor web"
          },
          "publisher": {
            "@type": "Organization",
            "name": "Question Notes",
            "logo": {
              "@type": "ImageObject",
              "url": "https://tse4.mm.bing.net/th?q=Question%20Notes"
            }
          },
          "datePublished": "2025-08-04T08:28:47+00:00",
          "dateModified": "2025-08-04T08:28:47+00:00"
        }
    </script>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="container nav-container">
                <div class="nav-left">
                    <span class="logo">Question Notes</span>
                    <span class="blog-tag">Article</span>
                </div>
                <div class="nav-search">
                    <form class="search-form" role="search">
                        <input 
                            type="search" 
                            class="search-input"
                            placeholder="Search articles..."
                            aria-label="Search articles"
                        >
                        <button type="submit" class="search-button" aria-label="Submit search">ðŸ”Ž</button>
                    </form>
                </div>
                <button class="nav-toggle" aria-label="Toggle navigation">
                    <span class="hamburger"></span>
                </button>
                <div class="nav-menu">
                    <ul class="nav-list">
                    	<li><a href="/" class="nav-link">HOME</a></li>
                        <li><a href="/pages/About" class="nav-link">About</a></li>
                        <li><a href="/pages/Contact" class="nav-link">Contact</a></li>
                        <li><a href="/pages/Disclaimer" class="nav-link">Disclaimer</a></li>
                        <li><a href="/pages/Privacy" class="nav-link">Privacy</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="main">
        <article class="article">
            <header class="article-header">
                <div class="container">
                    <h1>SamodBuilder Load Non-Send Future: Causes &amp; Solutions</h1>
                    <div class="meta">
                        <time datetime="2025-08-04T08:28:47+00:00">Aug 4, 2025</time>
                        <span class="author">by ADMIN</span>
                        <span class="view-count">
                            <span id="viewCount">54</span> views
                        </span>
                    </div>
                </div>
            </header>
            <div class="ad-header container">
                <!-- <div class="ad-wrapper">
    Iklan Headers
</div> -->
            </div>
            <div class="container">
                <div class="article-layout">
                    <div class="content">
                        <img src="https://tse4.mm.bing.net/th?q=Troubleshooting%20and%20Solutions%20for%20SamodBuilder%20Load%20Returns%20Non-Send%20Future" title="Troubleshooting and Solutions for SamodBuilder Load Returns Non-Send Future" width="300" height="200"/><p>Hey guys! Today, we're diving into a common issue you might encounter when using <code>SamodBuilder::load</code> in Rust, specifically when dealing with async functions and the <code>Send</code> trait. We'll break down the problem, understand why it happens, and explore several solutions to get you back on track. So, let's get started!</p>
<h2>Understanding the Non-Send Future Issue with SamodBuilder::load</h2>
<p>When working with asynchronous Rust, the <strong><code>Send</code> trait</strong> plays a crucial role in ensuring that data can be safely transferred between threads. In the context of <code>SamodBuilder::load</code>, a non-<code>Send</code> future error typically arises when you're using a type that isn't thread-safe within an async function that's expected to be <code>Send</code>. This often manifests as a compiler error like the one below:</p>
<pre><code class="hljs">error[E0277]: `Rc&lt;UnsafeCell&lt;ReseedingRng&lt;ChaCha12Core, OsRng&gt;&gt;&gt;` cannot be sent between threads safely
   --&gt; tests/automerge.rs:25:5
    |
25  |     async fn spawn(ep: Endpoint, _metrics: &amp;mut Registry) -&gt; Result&lt;Self&gt; {
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     |
    |     `Rc&lt;UnsafeCell&lt;ReseedingRng&lt;ChaCha12Core, OsRng&gt;&gt;&gt;` cannot be sent between threads safely
    |     within this `impl Future&lt;Output = Result&lt;AutomergeNode, anyhow::Error&gt;&gt;`
    |
    = help: within `impl Future&lt;Output = Result&lt;AutomergeNode, anyhow::Error&gt;&gt;`, the trait `Send` is not implemented for `Rc&lt;UnsafeCell&lt;ReseedingRng&lt;ChaCha12Core, OsRng&gt;&gt;&gt;`
note: required because it appears within the type `rand::rngs::thread::ThreadRng`
   --&gt; /home/philipp/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/rand-0.9.2/src/rngs/thread.rs:94:12
    |
94  | pub struct ThreadRng {
    |            ^^^^^^^^^
note: required because it&#39;s used within this `async` fn body
   --&gt; /home/philipp/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/samod-0.1.0/src/lib.rs:86:15
    |
86  |       ) -&gt; Self {
    |  _______________^
87  | |         let SamodBuilder {
88  | |             storage,
89  | |             runtime,
...   |
162 | |         Self { inner }
163 | |     }
    | |_____^
note: required because it&#39;s used within this `async` fn body
   --&gt; /home/philipp/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/samod-0.1.0/src/builder.rs:66:38
    |
66  |       pub async fn load(self) -&gt; Samod {
    |  ______________________________________^
67  | |         Samod::load(self).await
68  | |     }
    | |_____^
</code></pre>
<p>This error message, while a bit verbose, essentially tells you that a type (<code>Rc&lt;UnsafeCell&lt;ReseedingRng&lt;ChaCha12Core, OsRng&gt;&gt;&gt;</code>) within your code cannot be safely sent between threads. This usually happens when dealing with random number generators (RNGs) from the <code>rand</code> crate, specifically when they're stored across <code>await</code> points in an async function.</p>
<p>The core issue often stems from using <code>rand::rng()</code> which provides a thread-local RNG. This means that the RNG is tied to the current thread and isn't safe to share across different threads. When your async function suspends at an <code>await</code> point, it might resume on a different thread, leading to a potential race condition and the <code>Send</code> error. The <strong>key takeaway</strong> is that types stored across <code>.await</code> points in <code>async</code> functions need to implement the <code>Send</code> trait, ensuring they can be safely moved between threads.</p>
<h2>Why Does This Happen with Async Functions and the Send Trait?</h2>
<p>To really grasp this issue, let's break down why async functions and the <code>Send</code> trait are so intertwined. Async functions in Rust are designed to allow concurrent execution. When you use <code>.await</code>, you're essentially saying, &quot;Hey, this part might take a while, so let's allow the program to do other things while we wait.&quot; This is where the Rust runtime can potentially move the execution of your async function to a different thread.</p>
<p>The <code>Send</code> trait acts as a safety contract. It guarantees that a type is safe to move across thread boundaries. If a type doesn't implement <code>Send</code>, it means it has some internal state that could be corrupted if accessed concurrently from multiple threads. Common culprits for not implementing <code>Send</code> are types that use raw pointers or interior mutability without proper synchronization mechanisms, such as <code>Rc&lt;RefCell&lt;T&gt;&gt;</code>.</p>
<p>In the context of <code>SamodBuilder::load</code>, the error arises because the underlying implementation uses a random number generator that is not <code>Send</code>. When you <code>await</code> within the <code>load</code> function, the future might be moved to another thread, and the non-<code>Send</code> RNG becomes a problem. The error message pinpoints <code>Rc&lt;UnsafeCell&lt;ReseedingRng&lt;ChaCha12Core, OsRng&gt;&gt;&gt;</code> as the culprit, which is part of the internal state of the default <code>ThreadRng</code> used by <code>rand::rng()</code>. This <strong>deep dive into the mechanics</strong> of async functions and the <code>Send</code> trait helps us understand the error message and the underlying problem.</p>
<h2>Solutions to the SamodBuilder Load Non-Send Future Problem</h2>
<p>Okay, so we know <em>why</em> this happens. Now let's talk about <em>how</em> to fix it! There are several approaches you can take, each with its own trade-offs. Let's explore them:</p>
<h3>1. Confine <code>rand::rng()</code> Usage Between <code>await</code> Points</h3>
<p>This is often the simplest solution if it fits your use case. The idea is to ensure that you're only using the thread-local RNG provided by <code>rand::rng()</code> within a single execution context, without storing it across <code>await</code> points. This means generating random numbers only when you need them, and not holding onto the RNG instance itself across suspension points.</p>
<p>For example, instead of doing this:</p>
<pre><code class="hljs">async fn my_async_function() {
    let mut rng = rand::thread_rng();
    let random_number = rng.gen::&lt;u32&gt;();
    await something_expensive();
    println!(&quot;Random number: {}&quot;, random_number);
}
</code></pre>
<p>You would do this:</p>
<pre><code class="hljs">async fn my_async_function() {
    let random_number = rand::thread_rng().gen::&lt;u32&gt;();
    await something_expensive();
    println!(&quot;Random number: {}&quot;, rand::thread_rng().gen::&lt;u32&gt;()); // Generate a new random number after the await
}
</code></pre>
<p>By regenerating the random number after the <code>await</code>, we avoid storing the non-<code>Send</code> <code>rng</code> across the suspension point. This <strong>straightforward approach</strong> eliminates the need to share the RNG across threads, thus sidestepping the <code>Send</code> issue.</p>
<h3>2. Use <code>rand::rngs::OsRng</code></h3>
<p><code>rand::rngs::OsRng</code> is a random number generator that's specifically designed to be cryptographically secure and, importantly, it's <code>Send</code>! This RNG gets its randomness directly from the operating system, making it suitable for use in multi-threaded and async contexts.</p>
<p>To use <code>OsRng</code>, you simply replace your <code>rand::rng()</code> calls with <code>rand::rngs::OsRng::new().unwrap()</code>. For example:</p>
<pre><code class="hljs">use rand::rngs::OsRng;
use rand::RngCore;

async fn my_async_function() {
    let mut rng = OsRng::new().unwrap();
    let random_number = rng.next_u32();
    await something_expensive();
    println!(&quot;Random number: {}&quot;, random_number);
}
</code></pre>
<p><code>OsRng</code> is a <strong>robust solution</strong> because it's inherently thread-safe. However, keep in mind that it relies on the operating system's entropy source, which might have performance implications in certain scenarios. But for most use cases, it's an excellent choice.</p>
<h3>3. Use an RNG that Uses an <code>Arc</code> Internally</h3>
<p>This is a more advanced option, but it's worth considering if you need to share an RNG across multiple threads or tasks and want to avoid the potential performance overhead of creating a new <code>OsRng</code> instance each time. An <code>Arc</code> (Atomically Reference Counted) pointer allows you to safely share data between threads by keeping track of how many references exist.</p>
<p>While there isn't a built-in RNG in the <code>rand</code> crate that uses <code>Arc</code> directly, you could potentially create your own wrapper around an RNG and store it in an <code>Arc&lt;Mutex&lt;T&gt;&gt;</code> or <code>Arc&lt;RwLock&lt;T&gt;&gt;</code>. This would allow you to safely share and mutate the RNG across threads.</p>
<p>For example (note: this is a simplified example and might need adjustments for your specific use case):</p>
<pre><code class="hljs">use rand::{Rng, SeedableRng};
use rand::rngs::StdRng;
use std::sync::{Arc, Mutex};

struct ArcRng {
    inner: Arc&lt;Mutex&lt;StdRng&gt;&gt;,
}

impl ArcRng {
    fn new() -&gt; Self {
        ArcRng {
            inner: Arc::new(Mutex::new(StdRng::from_entropy())), // You can use a different RNG here
        }
    }

    fn gen_range(&amp;self, low: u32, high: u32) -&gt; u32 {
        let mut rng = self.inner.lock().unwrap();
        rng.gen_range(low..high)
    }
}

async fn my_async_function(rng: ArcRng) {
    let random_number = rng.gen_range(1, 100);
    await something_expensive();
    println!(&quot;Random number: {}&quot;, random_number);
}
</code></pre>
<p>This approach involves <strong>more complexity</strong> but gives you fine-grained control over how the RNG is shared and mutated. However, be mindful of potential lock contention when using <code>Mutex</code> in high-concurrency scenarios.</p>
<h3>4. Re-architecting Your Code to Avoid Storing the RNG Across Awaits</h3>
<p>Sometimes, the best solution isn't about finding a thread-safe RNG, but about rethinking your code's structure. If possible, try to refactor your code so that the need to store an RNG across <code>await</code> points is eliminated altogether.</p>
<p>This might involve breaking down your async function into smaller, more manageable pieces, or delegating the random number generation to a separate, non-async function. This <strong>holistic approach</strong> can lead to cleaner, more maintainable code, and often avoids the need for complex synchronization mechanisms.</p>
<h2>Choosing the Right Solution</h2>
<p>So, which solution should you choose? It really depends on your specific needs and constraints. Here's a quick guide:</p>
<ul>
<li><strong>Confine <code>rand::rng()</code> usage:</strong> Best if you only need random numbers in short bursts and don't need to maintain state across <code>await</code> points. Simple and efficient.</li>
<li><strong>Use <code>rand::rngs::OsRng</code>:</strong> A good general-purpose solution for most cases where you need a <code>Send</code> RNG. Provides good security and is relatively easy to use.</li>
<li><strong>Use an RNG with <code>Arc</code>:</strong> Suitable for scenarios where you need to share an RNG across multiple threads or tasks and want to minimize the overhead of creating new RNG instances. Requires more careful handling of synchronization.</li>
<li><strong>Re-architect your code:</strong> The most involved option, but can lead to the cleanest and most maintainable solution in the long run. Worth considering if you find yourself struggling with complex synchronization issues.</li>
</ul>
<h2>Conclusion</h2>
<p>Dealing with <code>Send</code> requirements in async Rust can sometimes feel like a headache, but understanding the underlying principles and the available solutions can make the process much smoother. When you encounter the <code>SamodBuilder::load</code> non-<code>Send</code> future error, remember the key concepts: async functions, <code>await</code> points, and the <code>Send</code> trait.</p>
<p>By carefully choosing the right random number generator and structuring your code to avoid sharing non-<code>Send</code> types across threads, you can overcome this hurdle and build robust, concurrent applications. So, keep these tips in mind, and happy coding!</p>

                    </div>
                    <aside class="related-posts">
                        <div class="ad-sidebar container">
                            <!-- <div class="ad-wrapper">
    <span>Iklan Related</span>
</div> -->
                        </div>
                        <h2 class="related-posts-title">Related Posts</h2><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/exploring-the-properties-operations-and">Exploring The Properties, Operations, And Applications Of A 2x2 Matrix</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-07-13T16:28:41+00:00">Jul 13, 2025</time>
		                        <span class="view-count">
									70 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/boarding-a-plane-a-stress">Boarding A Plane: A Stress-Free Guide</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-10T15:26:52+00:00">Aug 10, 2025</time>
		                        <span class="view-count">
									37 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/samsons-descendants-could-chiram-be">Samson&#39;s Descendants Could Chiram Be One? Exploring The Talmud&#39;s Claims</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-07-13T22:33:54+00:00">Jul 13, 2025</time>
		                        <span class="view-count">
									71 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/electricity-consumption-in-manufacturing-operations">Electricity Consumption In Manufacturing Operations</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-07-16T17:51:29+00:00">Jul 16, 2025</time>
		                        <span class="view-count">
									51 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/mastering-machine-friendly-json-for">Mastering Machine-Friendly JSON For Data Insights</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-09T19:32:35+00:00">Aug 9, 2025</time>
		                        <span class="view-count">
									49 views
		                        </span>
                            </div>
                        </article>
                    </aside>
                    <aside class="related-posts"></aside>
                </div>
            </div>
        </article>
        <a href="#" class="back-to-top" id="backToTop" title="Back to top">
        	<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-up" viewBox="0 0 16 16">
			  <path fill-rule="evenodd" d="M3.646 11.854a.5.5 0 0 0 .708 0L8 8.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708M2.4 5.2c0 .22.18.4.4.4h10.4a.4.4 0 0 0 0-.8H2.8a.4.4 0 0 0-.4.4"/>
			</svg>
		</a>
    </main>
    <footer class="footer">
        <div class="container">
            <p>Â© 2025 Question Notes</p>
        </div>
    </footer>
    <script>
    	(() => {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            const toggleMenu = () => {
                navMenu.classList.toggle('nav-menu-active');
                navToggle.classList.toggle('nav-toggle-active');
            };
            const backToTopHandler = (e) => {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            navToggle.addEventListener('click', toggleMenu);
            document.getElementById('backToTop').addEventListener('click', backToTopHandler);
            window.addEventListener('pagehide', () => {
                navToggle.removeEventListener('click', toggleMenu);
                document.getElementById('backToTop').removeEventListener('click', backToTopHandler);
            });
        })();
		(() => {
            window.addEventListener("DOMContentLoaded", (event) => {
                const ellHljs = document.createElement("script");
                ellHljs.setAttribute("src", "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js");
                ellHljs.onload = () => {
                    hljs.highlightAll();
                };
                document.querySelector("body").append(ellHljs);
                const ellFont = document.createElement("link");
                ellFont.setAttribute("href", "https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css");
                ellFont.setAttribute("rel", "stylesheet");
                document.querySelector("head").append(ellFont);
                window.addEventListener('pagehide', () => {
                    // ellHljs.remove();
                    ellFont.remove();
                });

            });
        })();
    </script>
    <!-- Histats.com  START  (aync)-->
<script type="text/javascript">var _Hasync= _Hasync|| [];
_Hasync.push(['Histats.start', '1,4957095,4,0,0,0,00010000']);
_Hasync.push(['Histats.fasi', '1']);
_Hasync.push(['Histats.track_hits', '']);
(function() {
var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
hs.src = ('//s10.histats.com/js15_as.js');
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
})();</script>
<!-- Histats.com  END  -->
    
    
</body>
</html>
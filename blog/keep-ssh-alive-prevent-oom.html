<!DOCTYPE html>
<html lang="en">
<head>
	<title>Keep SSH Alive: Prevent OOM Killer From Dropping Connections</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Keep SSH Alive: Prevent OOM Killer From Dropping Connections...">
    <link rel="canonical" href="https://catatansoal.github.io/blog/keep-ssh-alive-prevent-oom">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Keep SSH Alive: Prevent OOM Killer From Dropping Connections">
	<meta property="og:description" content="Keep SSH Alive: Prevent OOM Killer From Dropping Connections...">
	<meta property="og:url" content="https://catatansoal.github.io/blog/keep-ssh-alive-prevent-oom">
	<meta property="og:site_name" content="ANABEL">
	<meta property="article:published_time" content="2025-08-04T22:06:00+00:00">
	<meta property="article:author" content="ADMIN">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" as="script" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js">
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <link rel="preload" fetchpriority="high" as="image" href="https://tse4.mm.bing.net/th?q=Avoid%20Killing%20SSH%20in%20Out-of-Memory%20Situations%3A%20A%20Comprehensive%20Guide">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style type="text/css">
    	:root{--primary-color:#3740ff;--text-color:#202124;--background-color:#ffffff;--gray-100:#f8f9fa;--gray-200:#e9ecef}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;line-height:1.6;color:var(--text-color);background-color:var(--background-color)}.container{max-width:1200px;margin:0 auto;padding:0 1.5rem}.header{background-color:var(--background-color);border-bottom:1px solid var(--gray-200);position:sticky;top:0;z-index:100}.nav{padding:.5rem 0}.nav-container{display:flex;justify-content:space-between;align-items:center;gap:1rem}.nav-left{display:flex;align-items:center;flex-shrink:0}.logo{font-weight:700;color:var(--primary-color)}.blog-tag{margin-left:1rem;padding:.25rem .5rem;background-color:var(--gray-100);border-radius:4px;font-size:.875rem}.nav-search{flex-grow:1;max-width:300px}.search-form{position:relative;width:100%}.search-input{width:100%;padding:.5rem 2.5rem .5rem 1rem;border:1px solid var(--gray-200);border-radius:24px;font-size:.875rem;transition:all 0.2s}.search-input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgb(55 64 255 / .1)}.search-button{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#5f6368;cursor:pointer;padding:.25rem;display:flex;align-items:center;justify-content:center}.search-button:hover{color:var(--primary-color)}.nav-toggle{display:none;background:none;border:none;cursor:pointer;padding:.5rem}.hamburger{display:block;position:relative;width:24px;height:2px;background:var(--text-color);transition:all 0.3s}.hamburger::before,.hamburger::after{content:'';position:absolute;width:24px;height:2px;background:var(--text-color);transition:all 0.3s}.hamburger::before{top:-6px}.hamburger::after{bottom:-6px}.nav-toggle-active .hamburger{background:#fff0}.nav-toggle-active .hamburger::before{transform:rotate(45deg);top:0}.nav-toggle-active .hamburger::after{transform:rotate(-45deg);bottom:0}.nav-list{display:flex;list-style:none;gap:2rem}.nav-link{color:var(--text-color);text-decoration:none;font-size:.9rem;transition:color 0.2s}.nav-link:hover{color:var(--primary-color)}.article-header{padding:2rem 0;background-color:var(--gray-100)}.article-layout{display:grid;grid-template-columns:1fr 350px;gap:3rem;padding:1rem 0;align-items: start}h1,h2,h3,h4,h5,h6{font-family:"Crimson Text","Times New Roman",Times,serif}h1{font-size:2.5rem;line-height:1.2;margin-bottom:1rem}.meta{color:#5f6368;font-size:.875rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.view-count{display:inline-flex;align-items:center;gap:.25rem}.view-count svg{color:#5f6368}.content{min-width:0;border-bottom:1px solid #dddddd5e;margin-top:1rem;white-space:pre-line !important;overflow-wrap:break-word;overflow-x:auto;word-break:break-word}.lead{font-size:1.25rem;color:#5f6368;margin-bottom:2rem}h2,h3,h4,h5,h6{font-size:1.75rem;margin:1rem 0 1rem}p,pre,ol,ul>li{margin-bottom:1rem;font-family:"Newsreader",serif;font-optical-sizing:auto;font-style:normal;font-size:1.3rem;text-align: justify;}p>code{font-size:1rem;font-weight:700;padding:.1rem .3rem .1rem .3rem;background:#0000000f;color:#000;border-radius:5px}hr{margin:1rem 0 1rem 0}.code-example{background-color:var(--gray-100);padding:1.5rem;border-radius:8px;margin:1.5rem 0;overflow-x:auto}code{font-family:'Roboto Mono',monospace;font-size:.875rem}ul{margin:.2rem 0;padding-left:1.5rem}.related-posts{background-color:var(--gray-100);padding:1.5rem;border-radius:8px;position:sticky;top:5rem}.related-posts-title,.newpost-posts-list{font-size:1.75rem;margin:0 0 1rem}.related-posts-list{display:flex;flex-direction:column;gap:.5rem}.related-post,.newpost-post{border-bottom:1px solid #ddd;padding-bottom:10px;margin-bottom:10px}.related-post:last-child,.newpost-post:last-child{padding-bottom:0;border-bottom:none}.related-post-title,.newpost-post-title{font-size:1.2rem;margin:0 0 .1rem;font-family:"Newsreader",serif;font-optical-sizing:auto;font-style:normal;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;overflow: hidden;}.related-post-title a,.newpost-post-title a{color:var(--text-color);text-decoration:none;transition:color 0.2s}.related-post-title a:hover,.newpost-post-title a:hover{color:var(--primary-color)}.related-post time{font-size:.875rem;color:#5f6368}.footer{background-color:var(--gray-100);padding:2rem 0;margin-top:4rem;color:#5f6368;font-size:.875rem}.nav-menu>ul>li{margin-bottom:0}@media (max-width:1024px){.container{max-width:800px}.article-layout{grid-template-columns:1fr;gap:2rem}.related-posts{position:static}}@media (max-width:768px){.nav-container{flex-wrap:wrap}.nav-search{order:3;max-width:none;width:100%;margin-top:.1rem}.nav-toggle{display:block}.nav-menu{display:none;position:absolute;top:100%;left:0;right:0;background:var(--background-color);padding:1rem 0;border-bottom:1px solid var(--gray-200)}.nav-menu-active{display:block}.nav-list{flex-direction:column;gap:.1rem;padding:0 1.5rem}.nav-link{display:block;padding:.2rem 0}h1{font-size:2rem}.article-header{padding:2rem 0}.content{padding:.1rem 0}}table{width:100%;border-collapse:collapse;margin:20px 0;font-family:'Arial',sans-serif}th,td{padding:12px 15px;text-align:left;border:1px solid #ddd}th{background-color:#0F7F0B;color:#FFF}td{background-color:#f9f9f9}tr:nth-child(even) td{background-color:#f2f2f2}@media screen and (max-width:768px){table{border:0;display:block;overflow-x:auto;white-space:nowrap}th,td{padding:10px;text-align:right}th{background-color:#0F7F0B;color:#FFF}td{background-color:#f9f9f9;border-bottom:1px solid #ddd}tr:nth-child(even) td{background-color:#f2f2f2}}a{text-decoration:none;color:#540707}.katex-html{padding: .2rem;color: #000;font-weight: 700;font-size: 1.3rem;overflow-wrap: break-word;max-width: 100%;white-space: normal !important}.category{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin:1rem 0 1rem 0}.tag{font-size:1rem;font-weight:700;padding:.1rem .3rem .1rem .3rem;background:#0000000f;color:#000;border-radius:5px;font-family:"Newsreader",serif}.tag>a{text-decoration:none;color:#000}img{margin:auto;display:block;max-width:100%;height:auto;margin-bottom:1rem}.katex{white-space: pre-line !important;display: inline-block;max-width: 100%;overflow-x: auto;overflow-y: hidden;scrollbar-width: thin;overflow-wrap: break-word;word-break: break-word;vertical-align: -7px}.content > p {overflow-wrap: break-word;word-break: break-word}
    </style>
    <style type="text/css">
    	pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}
		.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}
    	pre{-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-weight:400;word-break:break-word;word-wrap:break-word;box-sizing:inherit;border-radius:4px;overflow-x:auto;font-family:source-code-pro,Menlo,Monaco,"Courier New",Courier,monospace}code{-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;word-wrap:break-word;word-break:break-word;font-style:normal;line-height:20px;letter-spacing:-.003em;box-sizing:inherit;font-weight:400;font-size:75%;font-family:source-code-pro,Menlo,Monaco,"Courier New",Courier,monospace}
    </style>
    <style type="text/css">
    	.back-to-top{position:fixed;bottom:20px;right:20px;background-color:#a73f3f;color:#fff;padding:8px 10px;border-radius:50%;box-shadow:0 4px 6px rgb(0 0 0 / .2);font-size:10px;font-weight:700;text-decoration:none;text-align:center;transition:opacity 0.3s ease,visibility 0.3s ease;z-index:99999;opacity:1;visibility:visible}.back-to-top:hover{background-color:#0056b3}
    </style>
    <style type="text/css">
        .ad-header {margin: 1rem auto 1rem;background-color: #fdfdfd;text-align: center;display: block;}.ad-header .ad-wrapper {min-height: 90px;display: flex;align-items: center;justify-content: center;font-size: 1rem;color: #555;font-weight: 500;padding: 3rem;border: 1px dashed #ccc;border-radius: 6px;}@media (max-width: 768px) {.ad-header {padding: 0.75rem;}}.ad-sidebar {margin: 0 0 1rem;background-color: #fefefe;text-align: center;padding: 0px;width: 100%;max-width: 100%;display: block;}.ad-sidebar .ad-wrapper {min-height: 250px;display: flex;align-items: center;justify-content: center;font-size: 1rem;color: #444;font-weight: 500;border: 1px dashed #aaa;border-radius: 6px;padding: 0rem;}@media (max-width: 1024px) {.ad-sidebar {padding: 0.75rem;}}
    </style>
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Article",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://catatansoal.github.io/blog/keep-ssh-alive-prevent-oom"
          },
          "headline": "Keep SSH Alive: Prevent OOM Killer From Dropping Connections",
          "description": "Keep SSH Alive: Prevent OOM Killer From Dropping Connections...",
          "image": [
            "https://tse4.mm.bing.net/th?q=Avoid%20Killing%20SSH%20in%20Out-of-Memory%20Situations%3A%20A%20Comprehensive%20Guide"
          ],
          "author": {
            "@type": "Person",
            "name": "ADMIN",
            "jobTitle": "Editor web"
          },
          "publisher": {
            "@type": "Organization",
            "name": "ANABEL",
            "logo": {
              "@type": "ImageObject",
              "url": "https://tse4.mm.bing.net/th?q=ANABEL%20WEB"
            }
          },
          "datePublished": "2025-08-04T22:06:00+00:00",
          "dateModified": "2025-08-04T22:06:00+00:00"
        }
    </script>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="container nav-container">
                <div class="nav-left">
                    <span class="logo">ANABEL</span>
                    <span class="blog-tag">Article</span>
                </div>
                <div class="nav-search">
                    <form class="search-form" role="search">
                        <input 
                            type="search" 
                            class="search-input"
                            placeholder="Search articles..."
                            aria-label="Search articles"
                        >
                        <button type="submit" class="search-button" aria-label="Submit search">🔎</button>
                    </form>
                </div>
                <button class="nav-toggle" aria-label="Toggle navigation">
                    <span class="hamburger"></span>
                </button>
                <div class="nav-menu">
                    <ul class="nav-list">
                    	<li><a href="/" class="nav-link">HOME</a></li>
                        <li><a href="/pages/About" class="nav-link">About</a></li>
                        <li><a href="/pages/Contact" class="nav-link">Contact</a></li>
                        <li><a href="/pages/Disclaimer" class="nav-link">Disclaimer</a></li>
                        <li><a href="/pages/Privacy" class="nav-link">Privacy</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="main">
        <article class="article">
            <header class="article-header">
                <div class="container">
                    <h1>Keep SSH Alive: Prevent OOM Killer From Dropping Connections</h1>
                    <div class="meta">
                        <time datetime="2025-08-04T22:06:00+00:00">Aug 4, 2025</time>
                        <span class="author">by ADMIN</span>
                        <span class="view-count">
                            <span id="viewCount">61</span> views
                        </span>
                    </div>
                </div>
            </header>
            <div class="ad-header container">
                <div class="ad-wrapper">
    Iklan Headers
</div>
            </div>
            <div class="container">
                <div class="article-layout">
                    <div class="content">
                        <img src="https://tse4.mm.bing.net/th?q=Avoid%20Killing%20SSH%20in%20Out-of-Memory%20Situations%3A%20A%20Comprehensive%20Guide" title="Avoid Killing SSH in Out-of-Memory Situations: A Comprehensive Guide" width="300" height="200"/><p>Hey guys! Ever been in that frustrating situation where your server runs out of memory, and the first thing to go is your SSH connection? It's like being locked out of your own house! This article is dedicated to helping you prevent that dreaded scenario. We'll dive deep into the technical aspects while keeping it conversational and easy to understand. So, let's get started!</p>
<h2>Understanding the Out-of-Memory (OOM) Killer</h2>
<p>When <strong>out-of-memory</strong> (OOM) conditions strike, your Linux kernel has a built-in mechanism called the OOM killer. Think of it as a last-resort measure to keep your system from completely crashing. When memory is critically low, the OOM killer steps in and starts terminating processes to free up memory. The big question is: how does it decide which processes to kill?</p>
<p>The OOM killer uses a scoring system to determine which processes are the best candidates for termination. Each process gets an <code>oom_score</code>, and the higher the score, the more likely it is to be killed. Several factors influence this score, including the amount of memory the process is using, the process's CPU usage, and its priority. System processes, especially those crucial for system stability, typically have lower scores, making them less likely to be targeted. However, even essential services aren't entirely immune, and that's where our problem lies – SSH being a prime example of a process we definitely want to keep alive.</p>
<p>To really grasp this, imagine your server's memory as a crowded room. When it gets too full, someone has to go. The OOM killer is the bouncer, deciding who gets the boot based on how much space they're taking up and how important they seem to be. Our mission is to make sure SSH looks like a VIP guest that should absolutely stay in the room. This involves tweaking the OOM killer's scoring system and telling it, &quot;Hey, leave SSH alone!&quot;</p>
<p>We'll explore practical steps you can take to protect your SSH sessions. We’ll cover everything from adjusting OOM scores to more advanced techniques, all explained in a way that’s easy to follow, even if you're not a Linux guru. So stick around, and let’s make sure you never lose that crucial SSH connection again!</p>
<h2>Why SSH is Often a Victim of OOM</h2>
<p>So, why is <strong>SSH</strong> so often the unlucky application that gets the axe when memory runs low? It might seem like a critical service, and it is, but the OOM killer sometimes sees things differently. Let's break down the reasons why SSH often becomes a target.</p>
<p>First off, SSH sessions, while relatively lightweight, can still consume a noticeable amount of memory, especially if there are multiple active connections or if users are running resource-intensive commands within their SSH sessions. Each active session spawns processes, and these processes take up memory. If a user starts compiling software, running database queries, or transferring large files over SSH, the memory footprint of the SSH daemon (<code>sshd</code>) and related processes can increase significantly.</p>
<p>Secondly, the OOM killer's scoring algorithm isn't perfect. It's designed to make quick decisions under pressure, and sometimes it misjudges the importance of a process. SSH, while vital for remote access, might not always have a low enough <code>oom_score</code> by default to protect it from being killed. The score calculation considers factors like memory usage and the process's niceness value (a measure of process priority). If SSH's memory usage spikes due to user activity, its score might rise, making it a target.</p>
<p>Moreover, consider the timing. OOM situations often arise when other memory-hungry processes are running, like databases, web servers, or virtualization platforms. These applications can consume the majority of available memory, leaving SSH vulnerable. When the OOM killer kicks in, it might see SSH as just another process contributing to the problem, without fully appreciating its role in allowing you to remotely manage the server and fix the memory issue!</p>
<p>Therefore, preventing SSH from being killed involves taking proactive steps. We need to lower SSH's <code>oom_score</code> and potentially implement other strategies to safeguard it. Think of it like giving SSH a special badge that says, &quot;Don't touch me! I'm important!&quot; We’ll explore exactly how to do this in the following sections. We’ll look at how to tweak the system to prioritize SSH, ensuring you always have a lifeline to your server, even in the most critical situations. Let's make sure that your SSH connection remains your trusty sidekick, ready to help you out of any memory crunch!</p>
<h2>Methods to Protect SSH from OOM Killing</h2>
<p>Okay, so now we understand why <strong>SSH</strong> is vulnerable to the OOM killer. Let's get into the nitty-gritty of how to protect it! There are several strategies we can employ, each with its own pros and cons. We'll start with the most common and straightforward method: adjusting the OOM score.</p>
<h3>1. Adjusting the OOM Score</h3>
<p>The most direct way to protect SSH is by lowering its <code>oom_score</code>. As we discussed earlier, the lower the score, the less likely a process is to be killed. You can adjust this score by writing a value to the <code>/proc/[pid]/oom_adj</code> or <code>/proc/[pid]/oom_score_adj</code> file for the SSH process. The recommended approach is to use <code>oom_score_adj</code> as <code>oom_adj</code> is deprecated.</p>
<p>To do this, you first need to find the Process ID (PID) of the SSH daemon (<code>sshd</code>). You can use the <code>ps</code> command along with <code>grep</code> to filter the output:</p>
<pre><code class="hljs">ps aux | grep sshd
</code></pre>
<p>This command will list all processes and filter for those containing &quot;sshd.&quot; Look for the main <code>sshd</code> process, not the individual SSH sessions. Once you have the PID, you can adjust the OOM score. The <code>oom_score_adj</code> file accepts values between -1000 and 1000. A value of -1000 completely disables OOM killing for that process, while 1000 makes it the prime target. A good starting point is to set it to -900, which gives SSH a very high level of protection.</p>
<p>Here’s the command to adjust the OOM score, replacing <code>[PID]</code> with the actual PID of your <code>sshd</code> process:</p>
<pre><code class="hljs">echo -900 | sudo tee /proc/[PID]/oom_score_adj
</code></pre>
<p>This command uses <code>sudo</code> because you need root privileges to modify these files. The <code>tee</code> command is used to write to the file with the necessary permissions. However, this change is temporary and will be reset if the <code>sshd</code> process restarts. To make it permanent, you need to automate this process.</p>
<p>There are a couple of ways to do this. One common method is to add a script to your system's init system (like systemd) that runs after the <code>sshd</code> service starts. Another approach is to create a <code>udev</code> rule that triggers when the <code>sshd</code> process starts. We'll dive into how to automate this in the next section. For now, remember that adjusting the OOM score is a powerful way to safeguard SSH, but it requires persistence to be truly effective.</p>
<h3>2. Automating OOM Score Adjustment</h3>
<p>So, we've seen how to manually adjust the <strong>OOM score</strong> for SSH, which is a great first step. But, let's be honest, manually setting this every time the SSH daemon restarts is a pain. We need a way to automate this process to ensure SSH is always protected. There are a few methods we can use, and we'll walk through a couple of the most common ones.</p>
<h4>a. Using systemd</h4>
<p>If your system uses <code>systemd</code> (which is the case for most modern Linux distributions), you can create a <code>systemd</code> drop-in configuration file for the <code>sshd</code> service. This allows you to override specific settings without modifying the main service file, which is a cleaner and safer approach. Here’s how you can do it:</p>
<ol>
<li>
<p>Create a directory for the drop-in configuration file:</p>
<pre><code class="hljs">sudo mkdir -p /etc/systemd/system/sshd.service.d/
</code></pre>
</li>
<li>
<p>Create a configuration file (e.g., <code>override.conf</code>) in the newly created directory:</p>
<pre><code class="hljs">sudo nano /etc/systemd/system/sshd.service.d/override.conf
</code></pre>
</li>
<li>
<p>Add the following content to the file:</p>
<pre><code class="hljs">[Service]
OOMScoreAdjust=-900
</code></pre>
<p>This tells <code>systemd</code> to set the <code>oom_score_adj</code> for the <code>sshd</code> service to -900.</p>
</li>
<li>
<p>Save the file and exit the text editor.</p>
</li>
<li>
<p>Reload the <code>systemd</code> configuration and restart the <code>sshd</code> service:</p>
<pre><code class="hljs">sudo systemctl daemon-reload
sudo systemctl restart sshd
</code></pre>
<p>Now, every time <code>sshd</code> starts, <code>systemd</code> will automatically set the OOM score adjustment to -900. This is a much more reliable and permanent solution than manually setting the score.</p>
</li>
</ol>
<h4>b. Using a Script in Init System</h4>
<p>Another way to automate this is by creating a script that runs during the boot process or when the <code>sshd</code> service starts. This method is a bit more generic and can be adapted to different init systems.</p>
<ol>
<li>
<p>Create a script (e.g., <code>/usr/local/bin/set_ssh_oom_score.sh</code>) with the following content:</p>
<pre><code class="hljs">#!/bin/bash

# Get the PID of sshd
PID=$(pgrep sshd)

if [ -n &quot;$PID&quot; ]; then
    # Set the OOM score adjustment
    echo -900 | tee /proc/$PID/oom_score_adj
    echo &quot;Set OOM score adjustment for sshd (PID $PID) to -900&quot; 
else
    echo &quot;sshd process not found&quot;
fi

exit 0
</code></pre>
<p>This script finds the PID of <code>sshd</code> and sets its <code>oom_score_adj</code> to -900. It also includes error checking and logging.</p>
</li>
<li>
<p>Make the script executable:</p>
<pre><code class="hljs">sudo chmod +x /usr/local/bin/set_ssh_oom_score.sh
</code></pre>
</li>
<li>
<p>Now, you need to integrate this script into your init system. The exact method depends on your system:</p>
<ul>
<li><strong>systemd:</strong> You can create a service file that runs this script after <code>sshd.service</code> starts.</li>
<li><strong>SysVinit:</strong> You can add the script to <code>/etc/init.d/</code> and create symbolic links in the appropriate runlevels.</li>
</ul>
<p>For systemd, you might create a service file like <code>/etc/systemd/system/set-ssh-oom.service</code> with the following content:</p>
<pre><code class="hljs">[Unit]
Description=Set OOM score adjustment for sshd
After=sshd.service

[Service]
Type=oneshot
ExecStart=/usr/local/bin/set_ssh_oom_score.sh

[Install]
WantedBy=multi-user.target
</code></pre>
<p>Then, enable and start the service:</p>
<pre><code class="hljs">sudo systemctl enable set-ssh-oom.service
sudo systemctl start set-ssh-oom.service
</code></pre>
</li>
</ol>
<p>By automating the <strong>OOM score adjustment</strong>, you ensure that SSH is consistently protected, even after restarts. This is a crucial step in maintaining reliable remote access to your server. We’ve covered two solid methods here, and choosing the right one depends on your specific system and preferences. Now that we have the OOM score handled, let’s move on to some other techniques that can further safeguard your SSH connection!</p>
<h3>3. Limiting Memory Usage</h3>
<p>Another effective way to protect <strong>SSH</strong> from being killed by the OOM killer is to limit its memory usage. This might sound counterintuitive – after all, we want SSH to function properly – but by setting reasonable limits, we can prevent it from becoming a major memory hog and, therefore, a target for the OOM killer.</p>
<p>One way to limit memory usage is by configuring the <code>MaxSessions</code> and <code>ClientAliveInterval</code> settings in the <code>sshd_config</code> file. These settings help manage the number of active SSH sessions and ensure that inactive sessions are terminated, freeing up resources.</p>
<ul>
<li>
<p><strong>MaxSessions:</strong> This option limits the number of concurrent SSH sessions allowed. Each session consumes memory, so reducing the number of sessions can significantly lower SSH's overall memory footprint. A reasonable value depends on your server's resources and usage patterns, but starting with a lower number like 10 or 20 can be a good idea. You can always adjust it later if needed.</p>
</li>
<li>
<p><strong>ClientAliveInterval:</strong> This setting configures the server to send keep-alive messages to clients at a specified interval (in seconds). If a client doesn't respond after a certain number of keep-alive messages, the server will terminate the connection. This helps prevent zombie SSH sessions from consuming resources unnecessarily. Setting <code>ClientAliveInterval</code> to 300 (5 minutes) and <code>ClientAliveCountMax</code> to 3 (meaning 3 missed keep-alive messages) is a common practice.</p>
</li>
</ul>
<p>To configure these settings, you'll need to edit the <code>sshd_config</code> file, which is typically located at <code>/etc/ssh/sshd_config</code>. Use a text editor with root privileges to modify the file:</p>
<pre><code class="hljs">sudo nano /etc/ssh/sshd_config
</code></pre>
<p>Add or modify the following lines:</p>
<pre><code class="hljs">MaxSessions 10
ClientAliveInterval 300
ClientAliveCountMax 3
</code></pre>
<p>Save the file and exit the editor. Then, restart the <code>sshd</code> service to apply the changes:</p>
<pre><code class="hljs">sudo systemctl restart sshd
</code></pre>
<p>By limiting the number of sessions and cleaning up inactive connections, you can reduce the likelihood of SSH consuming excessive memory. This, in turn, makes it less likely to be targeted by the OOM killer.</p>
<p>Another approach to limiting memory usage is to use resource limits at the operating system level. Tools like <code>ulimit</code> can be used to set limits on various resources, including memory. However, this method is more complex and requires careful consideration to avoid negatively impacting SSH's functionality. For most use cases, configuring <code>MaxSessions</code> and <code>ClientAliveInterval</code> provides a good balance between security and resource management.</p>
<p>So, remember, keeping SSH lean and mean is a key part of protecting it from the OOM killer. By limiting memory usage, we make SSH a less tempting target, ensuring it remains available when you need it most. Now, let’s move on to our final method, which involves a bit more proactive monitoring and management of your server's resources.</p>
<h3>4. Monitoring and Proactive Management</h3>
<p>The most effective way to avoid OOM situations, and thus prevent <strong>SSH</strong> from being killed, is to proactively monitor your server's resources and manage them effectively. This involves keeping an eye on memory usage, identifying potential memory leaks, and addressing them before they lead to an out-of-memory condition.</p>
<p>There are several tools you can use to monitor your server's memory usage. Some popular options include:</p>
<ul>
<li>
<p><strong>top:</strong> This command-line tool provides a real-time view of system resource usage, including memory, CPU, and processes. It's a great way to get a quick overview of what's happening on your server.</p>
</li>
<li>
<p><strong>htop:</strong> A more interactive and visually appealing alternative to <code>top</code>. It provides similar information but with better usability and color-coding.</p>
</li>
<li>
<p><strong>free:</strong> This command displays the amount of free and used memory in your system. It's useful for getting a snapshot of memory usage at a specific point in time.</p>
</li>
<li>
<p><strong>vmstat:</strong> A versatile tool that reports various system statistics, including memory usage, CPU activity, and disk I/O. It can provide more detailed insights into memory-related issues.</p>
</li>
</ul>
<p>By regularly checking these tools, you can identify trends and potential problems before they escalate. For example, if you notice that memory usage is consistently increasing over time, it might indicate a memory leak in one of your applications.</p>
<p>In addition to these command-line tools, there are also graphical monitoring solutions like <strong>Grafana</strong>, <strong>Prometheus</strong>, and <strong>Zabbix</strong>. These tools provide more advanced features, such as historical data analysis, alerting, and visualizations. They can be particularly useful for larger deployments where you need to monitor multiple servers.</p>
<p>Proactive management also involves taking steps to prevent memory exhaustion. This might include:</p>
<ul>
<li>
<p><strong>Optimizing applications:</strong> Reviewing your applications' memory usage and identifying areas for optimization. This could involve fixing memory leaks, reducing memory consumption, or using more efficient data structures.</p>
</li>
<li>
<p><strong>Scaling resources:</strong> If your server is consistently running low on memory, consider upgrading to a server with more RAM. Alternatively, you could explore horizontal scaling by distributing your workload across multiple servers.</p>
</li>
<li>
<p><strong>Regularly restarting services:</strong> Some applications might accumulate memory over time, even without a memory leak. Regularly restarting these services can help free up memory and prevent OOM situations.</p>
</li>
<li>
<p><strong>Using swap space wisely:</strong> Swap space can provide a temporary buffer when memory is running low, but it's not a substitute for sufficient RAM. If your server is frequently using swap, it's a sign that you need to address the underlying memory issue.</p>
</li>
</ul>
<p>By actively monitoring your server's resources and taking proactive steps to manage them, you can significantly reduce the risk of OOM errors and ensure that SSH remains available. Think of it like preventative maintenance for your server – a little effort upfront can save you a lot of headaches down the road!</p>
<h2>Conclusion</h2>
<p>Alright guys, we've covered a lot of ground in this article! Protecting <strong>SSH</strong> from the OOM killer is crucial for maintaining reliable access to your server, especially when things go south. We've explored several methods, from adjusting the OOM score to limiting memory usage and proactive monitoring. Each technique plays a vital role in safeguarding your SSH connection.</p>
<p>Let's recap the key takeaways:</p>
<ul>
<li><strong>Understanding the OOM Killer:</strong> Know how it works and why SSH can become a target.</li>
<li><strong>Adjusting the OOM Score:</strong> Use <code>oom_score_adj</code> to lower SSH's score and make it less likely to be killed.</li>
<li><strong>Automating OOM Score Adjustment:</strong> Implement a persistent solution using <code>systemd</code> or a script in your init system.</li>
<li><strong>Limiting Memory Usage:</strong> Configure <code>MaxSessions</code> and <code>ClientAliveInterval</code> in <code>sshd_config</code> to manage SSH's memory footprint.</li>
<li><strong>Monitoring and Proactive Management:</strong> Regularly monitor your server's resources and address potential issues before they lead to OOM errors.</li>
</ul>
<p>By implementing these strategies, you can significantly reduce the risk of losing your SSH connection during an OOM situation. Remember, a little bit of preventative work can save you a lot of trouble later on. It’s like having a safety net for your server – you hope you never need it, but it’s great to know it’s there!</p>
<p>So, go ahead and implement these techniques on your servers. Protect your SSH, and keep those connections alive! And remember, if you run into any issues or have questions, don't hesitate to dive deeper into the documentation or ask for help from the community. Happy server managing!</p>

                    </div>
                    <aside class="related-posts">
                        <div class="ad-sidebar container">
                            <div class="ad-wrapper">
    <span>Iklan Related</span>
</div>
                        </div>
                        <h2 class="related-posts-title">Related Posts</h2><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/fix-laravel-forge-cli-invalid">Fix: Laravel Forge CLI - Invalid API Token Error</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-02T03:19:26+00:00">Aug 2, 2025</time>
		                        <span class="view-count">
									48 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/librechat-update-bug-invalid-data">LibreChat Update Bug Invalid Data With Azure Inception Jais Model</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-07-17T03:45:23+00:00">Jul 17, 2025</time>
		                        <span class="view-count">
									65 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/drywall-mud-taping-gaps-and">Drywall Mud: Taping, Gaps &amp; Choosing The Right Compound</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-05T23:15:21+00:00">Aug 5, 2025</time>
		                        <span class="view-count">
									55 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/stop-husbands-verbal-abuse-a">Stop Husband&#39;s Verbal Abuse: A Guide For Wives</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-10T02:21:34+00:00">Aug 10, 2025</time>
		                        <span class="view-count">
									46 views
		                        </span>
                            </div>
                        </article><article class="related-post">
                            <h3 class="related-post-title">
                                <a href="https://catatansoal.github.io/blog/build-muscle-your-ultimate-guide">Build Muscle: Your Ultimate Guide To Mass And Strength</a>
                            </h3>
                            <div class="meta">
                            	<time datetime="2025-08-04T15:01:20+00:00">Aug 4, 2025</time>
		                        <span class="view-count">
									54 views
		                        </span>
                            </div>
                        </article>
                    </aside>
                    <aside class="related-posts"></aside>
                </div>
            </div>
        </article>
        <a href="#" class="back-to-top" id="backToTop" title="Back to top">
        	<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-up" viewBox="0 0 16 16">
			  <path fill-rule="evenodd" d="M3.646 11.854a.5.5 0 0 0 .708 0L8 8.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708M2.4 5.2c0 .22.18.4.4.4h10.4a.4.4 0 0 0 0-.8H2.8a.4.4 0 0 0-.4.4"/>
			</svg>
		</a>
    </main>
    <footer class="footer">
        <div class="container">
            <p>© 2025 ANABEL</p>
        </div>
    </footer>
    <script>
    	(() => {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            const toggleMenu = () => {
                navMenu.classList.toggle('nav-menu-active');
                navToggle.classList.toggle('nav-toggle-active');
            };
            const backToTopHandler = (e) => {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            navToggle.addEventListener('click', toggleMenu);
            document.getElementById('backToTop').addEventListener('click', backToTopHandler);
            window.addEventListener('pagehide', () => {
                navToggle.removeEventListener('click', toggleMenu);
                document.getElementById('backToTop').removeEventListener('click', backToTopHandler);
            });
        })();
		(() => {
            window.addEventListener("DOMContentLoaded", (event) => {
                const ellHljs = document.createElement("script");
                ellHljs.setAttribute("src", "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js");
                ellHljs.onload = () => {
                    hljs.highlightAll();
                };
                document.querySelector("body").append(ellHljs);
                const ellFont = document.createElement("link");
                ellFont.setAttribute("href", "https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css");
                ellFont.setAttribute("rel", "stylesheet");
                document.querySelector("head").append(ellFont);
                window.addEventListener('pagehide', () => {
                    // ellHljs.remove();
                    ellFont.remove();
                });

            });
        })();
    </script>
    
    
    
</body>
</html>